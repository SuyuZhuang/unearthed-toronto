{% extends "header.html" %}

{% block title %}Reports{% endblock %}

{% block style %}
#accordion .panel-heading { padding: 0;}
#accordion .panel-title > a {
	display: block;
	padding: 0.4em 0.6em;
	outline: none;
	font-weight:bold;
	text-decoration: none;
}

#accordion .panel-title > a.accordion-toggle::before, #accordion a[data-toggle="collapse"]::before  {
	content:"\e113";
	float: left;
	font-family: 'Glyphicons Halflings';
	margin-right :1em;
}

#accordion .panel-title > a.accordion-toggle.collapsed::before, #accordion a.collapsed[data-toggle="collapse"]::before  {
	content:"\e114";
}

#accordion .panel, .panel-group .panel-heading+.panel-collapse>.panel-body{
    border: none;
    padding: 5px 0 0 0;
}
{% endblock %}

{% block page_header %}{% endblock %}

{% block content %}

<div style="text-align: left; width: 95%; margin: 30px auto auto auto;">
{% if watchlist %}
	<h1>My Watchlist</h1>
	<h3>List of properties added to your watchlist.</h3>

	{% for item in watchlist %}
		<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
			<div class="panel panel-default">
				<div class="panel-heading" role="tab" id="{{ item.mine_id }}">
					<h4 class="panel-title">
						<a role="button" data-toggle="collapse" data-parent="#accordion" href="#{{ item.collapse_id }}" aria-expanded="false" class="collapsed" aria-controls="{{ item.collapse_id }}">
							{{ item.name }}
						</a>
					</h4>
				</div>
				<div id="{{ item.collapse_id }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="{{ item.mine_id }}">
					<div class="panel-body">
						{% if item.articles %}
							<ul class="list-group">
							{% for a in item.articles %}
								<li class="list-group-item">
								{% if a.type == 'news' %}
									<i class="fa fa-newspaper-o" aria-hidden="true"></i>
									<a href="{{ a.url }}" target="_blank"><b>{{ a.title }}</b></a>
									<br>
									{{ a.source }} - {{ a.date }}
									<br>
									{{ a.description }}
								{% elif a.type == 'academic' %}
									<i class="fa fa-graduation-cap" aria-hidden="true"></i>
                                    <a href="{{ a.url }}"><b>{{ a.title }}</b></a>
                                    <br>
                                    {{ a.author }} - {{ a.source }} - {{ a.date }}
                                    <br>
                                    {{ a.description }}
                                    <br>
                                    Cited by {{ a.cited_by }}
								{% elif a.type == 'search' %}
									<i class="fa fa-search" aria-hidden="true"></i>
                                    <a href="{{ a.url }}"><b>{{ a.title }}</b></a>
                                    <br>
                                    {{ a.date }}
                                    <br>
                                    {{ a.description }}
								{% else %}
								{% endif %}
								</li>
							{% endfor %}
							</ul>
						{% else %}
							<p style="padding-left:5px">No articles available. Please check back later.</p>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	{% endfor %}
	

{% else %}
	<h3>
		Looks like there is nothing added to your watchlist yet... Go <a href='/explore'>explore</a>!
	</h3>
{% endif %}
</div>


<script>
$('#filter_btn').on('click', function() {
	//alert('clicked!!!');
	$('#report_iframe').hide();
	$('#overlay').show();
	$.getJSON('/generate_report/', {
		rpt: $('#rpt-select').val()
	}, function(data) {
		result = data.result;
		if (result == 'Success') {
			//alert(data.report);
			window.location.href = data.report;
		} else {
			window.location.reload();
		}
	});
	return false;
});

</script>
{% endblock %}
